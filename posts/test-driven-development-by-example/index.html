<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Test-Driven Development By Example" /><meta name="author" content="George Aristy" /><meta property="og:locale" content="en_US" /><meta name="description" content="Written by Kent Beck, Test-Driven Development By Example explains how TDD works by way of 2 examples: first building piece by piece a toy Money class, then the initial scaffolds of xUnit. The third and final part of the book walks the reader through several TDD patterns as well as refactoring patterns." /><meta property="og:description" content="Written by Kent Beck, Test-Driven Development By Example explains how TDD works by way of 2 examples: first building piece by piece a toy Money class, then the initial scaffolds of xUnit. The third and final part of the book walks the reader through several TDD patterns as well as refactoring patterns." /><link rel="canonical" href="https://georgearisty.dev/posts/test-driven-development-by-example/" /><meta property="og:url" content="https://georgearisty.dev/posts/test-driven-development-by-example/" /><meta property="og:site_name" content="George Aristy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-16T10:30:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Test-Driven Development By Example" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@George Aristy" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"George Aristy"},"dateModified":"2022-11-26T09:29:20-05:00","datePublished":"2022-04-16T10:30:00-04:00","description":"Written by Kent Beck, Test-Driven Development By Example explains how TDD works by way of 2 examples: first building piece by piece a toy Money class, then the initial scaffolds of xUnit. The third and final part of the book walks the reader through several TDD patterns as well as refactoring patterns.","headline":"Test-Driven Development By Example","mainEntityOfPage":{"@type":"WebPage","@id":"https://georgearisty.dev/posts/test-driven-development-by-example/"},"url":"https://georgearisty.dev/posts/test-driven-development-by-example/"}</script><title>Test-Driven Development By Example | George Aristy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="George Aristy"><meta name="application-name" content="George Aristy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="/assets/lib/bootstrap-4.6.1/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free-5.15.4/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup-1.1.0/magnific-popup.css"> <script src="/assets/lib/jquery-3.6.0/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/portrait.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">George Aristy</a></div><div class="site-subtitle font-italic">Blog about software craftmanship</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/bookshelf/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKSHELF</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/talks/" class="nav-link"> <i class="fa-fw fas fa-comment ml-xl-3 mr-xl-3 unloaded"></i> <span>TALKS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/llorllale" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['george.aristy','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/georgearisty/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/1623885/george-aristy" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Test-Driven Development By Example</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Test-Driven Development By Example</h1><div class="post-meta text-muted"><div> By <em> <a href="https://www.linkedin.com/in/georgearisty">George Aristy</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1650119400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-16 </em> </span> <span> Updated <em class="timeago" data-ts="1669472960" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-11-26 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2194 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 300'%3E%3C/svg%3E" data-src="/assets/img/books/test-driven-development/front-cover.jpg" alt="cover" class="left" height="300" width="200" data-proofer-ignore> Written by <a href="https://www.kentbeck.com/">Kent Beck</a>, <a href="https://www.amazon.ca/Test-Driven-Development-Kent-Beck/dp/0321146530/">Test-Driven Development By Example</a> explains how <a href="https://en.wikipedia.org/wiki/Test-driven_development">TDD</a> works by way of 2 examples: first building piece by piece a toy <code class="language-plaintext highlighter-rouge">Money</code> class, then the initial scaffolds of <a href="https://en.wikipedia.org/wiki/XUnit">xUnit</a>. The third and final part of the book walks the reader through several TDD patterns as well as refactoring patterns.</p><p>Kent Beck built <a href="http://sunit.sourceforge.net/">SUnit</a> for Smalltalk, and ported it over to Java as <a href="https://junit.org/junit5/">JUnit</a>.</p><p>Kent developed <a href="https://en.wikipedia.org/wiki/Extreme_programming">Extreme Programming (XP)</a> of which TDD is a central component. Being driven by examples and principles derived from experience, <em>Test-Driven Development By Example</em> needs to be understood within the context of <em>Extreme Programming</em><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p><p>Following are a brief summary and some notes taken from interesting sections of the book.</p><p><em>Check out some other books I’ve read on the <a href="/bookshelf/">bookshelf</a>.</em></p><h1 id="summary">Summary</h1><p><em>Test-Driven Development By Example</em> defines the TDD methodology and demonstrates its use by working through two examples:</p><ul><li>A <em>Money</em> class written in Java that requires a unified API to handle simple arithmetic between amounts expressed in different currencies.<li>The beginnings of a test suite framework (<em>xUnit</em>) written in Python.</ul><p>Several <a href="#testing-tips">tips</a> and <a href="#techniques">techniques</a> are provided for writing tests. A brief walkthrough of some simple design patterns is found as well (see chapter 30).</p><p>In Chapter 31 <em>Refactoring</em>, Kent makes the effort of codifying into words the different kind of things software engineers do when refactoring code every day:</p><ul><li>Reconcile differences<li>Isolate change<li>Migrate Data<li>Extract Method<li>Extract Interface<li>Inline Method<li>Move Method<li>Method Object<li>Add Parameter<li>Method Parameter to Constructor Parameter</ul><p>The amount of verbiage the book invests in the refactoring tips above might sound somewhat scary and daunting, but it really is nothing more than the bread and butter of every software engineer’s day-to-day.</p><h1 id="the-method">The Method</h1><p>The Test-Driven Development method.</p><ol><li>Write one test.<ol><li>Always work on one test at a time. Append to a TODO list other test scenarios that you may think of while you work on the current one.<li>How or when to write a test? See <a href="#testing-tips">tips</a> and <a href="#green-bar-patterns">patterns</a>.</ol><li>Make the test pass by either:<ol><li>Obvious Implementation: if the implementation is obvious and will take you a short time (seconds? minutes?), then just type that in.<li>Faking It: if the implementation is not obvious or will take you a long time, return a constant that makes the test pass</ol><li>Refactor:<ol><li>Primarily by removing duplication.<li>However, your own judgement and knowledge can drive refactors as well (Kent at one point refactored <em>Money</em> to make it immutable, something that was not strictly required.<li>(Optional) Added by me: if you relied on hard-coded constants in your implementation to keep the bar GREEN, make sure you change the values of any constants in your tests in order to snuff out constants you may have accidentally forgotten about in the implementation.</ol></ol><p>Repeat these steps until all tests (see step <code class="language-plaintext highlighter-rouge">1.1</code>) are implemented and are GREEN.</p><h1 id="testing-tips">Testing Tips</h1><p>These are covered in Chapter 26 <em>Red Bar Patterns</em> and are about when you write tests, where you write tests, and when you stop writing tests.</p><h2 id="write-explanatory-tests"><span class="mr-2">Write Explanatory Tests</span><a href="#write-explanatory-tests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Particularly useful when reporting bugs. Conversely…</p><h2 id="write-regression-tests"><span class="mr-2">Write Regression Tests</span><a href="#write-regression-tests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>First thing to do when a bug is reported: write a regression test that will be GREEN once the bug is fixed.</p><h2 id="write-learning-tests"><span class="mr-2">Write “Learning Tests”</span><a href="#write-learning-tests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Learn how 3rd party code works by writing quick demonstrations in the form of tests. I also use this technique when learning how std lib components work.</p><h1 id="test-techniques">Test Techniques</h1><h2 id="child-test"><span class="mr-2">Child Test</span><a href="#child-test" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>If the test case is turning out to be too big, write a smaller test case for a portion of the bigger test case. This could influence the design by breaking the desired implementation into several methods or objects as opposed to one monolithic function.</p><h2 id="mock-object"><span class="mr-2">Mock Object</span><a href="#mock-object" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>If your object-under-test relies on an expensive or complicated resource then create a fake version of the resource with fixed responses:</p><p>My notes:</p><ul><li>can influence design by abstracting the complicated dependency out into an interface<li>should add caveats for when unit tests do not provide value, such as with non-trivial SQL queries<ul><li>see www.mockobjects.com<li>Kent already considers databases (p. 144). Didn’t mention in-memory or lite production-like databases like:<ul><li><a href="https://www.h2database.com/html/main.html">H2</a> (Java)<li>sqlite<ul><li><a href="https://github.com/mattn/go-sqlite3">mattn/go-sqlite3</a> (Go, requires Cgo for installation)<li><a href="https://mvnrepository.com/artifact/org.xerial/sqlite-jdbc">sqlite JDBC driver</a> (Java)</ul><li><a href="https://github.com/dolthub/go-mysql-server">go-mysql-server</a><ul><li>Have run into DATA RACE errors, see <a href="https://github.com/dolthub/go-mysql-server/issues/562">dolthub/go-mysql-server#562</a></ul></ul></ul></ul><h2 id="self-shunt"><span class="mr-2">Self Shunt</span><a href="#self-shunt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Test that an object communicates correctly with another by having the test object communicate with the test case instead of an instance of that object.</p><p>My notes:</p><ul><li>Should we use this in place of Mock Object?<li>Seems to only be useful when implementing observer/listener pattern?</ul><h2 id="log-string"><span class="mr-2">Log String</span><a href="#log-string" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Test for the correct sequence of “messages” (aka. method invocations) by logging them to a string and compare the expectation.</p><p>For some reason this one seems a little too prescriptive for me.</p><h2 id="crash-test-dummy"><span class="mr-2">Crash Test Dummy</span><a href="#crash-test-dummy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Sometimes you have a test case for critical edge conditions that would be hard or unreliably reproduced in practice, like testing code that handles a full filesystem error. In such an example, instead of making your test fixture fill up your filesystem (bad idea) to replicate the error condition, have the fake implementation of your filesystem abstraction throw a suitable error that your application must handle.</p><h1 id="green-bar-patterns">Green Bar Patterns</h1><p>Different approaches to getting your tests GREEN. This is probably one of the most contentious parts of TDD.</p><h2 id="fake-it-til-you-make-it"><span class="mr-2">Fake It (‘Til You Make It)</span><a href="#fake-it-til-you-make-it" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>First implementation for a broken test should just return a constant that matches the test’s expectations. Seems highly important for some people to keep the bar green no matter how fake it is. Kent even qualifies such acts as “sins”, although presumably justified.</p><p>I highly recommend others do the following if they’re faking behaviour in TDD: once you think the test case <em>and</em> implementation are “done”, alter the test’s expected values slightly to sniff out forgotten constants in your implementation. This is especially crucial if the test asserts the object-under-test sends correct messages to other objects.</p><h2 id="triangulate"><span class="mr-2">Triangulate</span><a href="#triangulate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Abstract only when you have two or more examples.</p></blockquote><p>This is one of the trickier aspects of TDD, mostly due to proponents strongly pushing for <em>faking it</em>.</p><p>If you have a function <code class="language-plaintext highlighter-rouge">Add</code> that takes two <code class="language-plaintext highlighter-rouge">int</code> args and must return their sum, what are the proper TDD steps that take you from A to Z?</p><p>Step A:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">TestAdd</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">expected</span> <span class="o">:=</span> <span class="m">4</span>
    <span class="n">actual</span> <span class="o">:=</span> <span class="n">Add</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
    <span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="m">4</span>
<span class="p">}</span>
</pre></table></code></div></div><p>What would be the next step? In these scenarios I would personally opt for randomizing the values of <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> and asserting <code class="language-plaintext highlighter-rouge">Add</code> returns their sum, but some people argue that unit tests should be entirely deterministic, presumably to avoid flaky tests. It’s difficult for me to see how randomizing the inputs in <code class="language-plaintext highlighter-rouge">TestAdd</code> would make the test flaky but anyway.</p><p>Kent recommends adding another sample set of inputs to the test and <em>triangulate</em> the real implementation from those.</p><p>Step Z:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">TestAdd</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">expected</span> <span class="o">:=</span> <span class="m">4</span>
    <span class="n">actual</span> <span class="o">:=</span> <span class="n">Add</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
    <span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
    
    <span class="n">expected</span> <span class="o">=</span> <span class="m">7</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
    <span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The problem I have with this is how to do we mechanically reach step Z and not fall astray? Couldn’t the implementation have theoretically been entirely faked?</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">Add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="n">values</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span> <span class="p">{</span>
        <span class="m">2</span><span class="o">:</span> <span class="m">4</span><span class="p">,</span>
        <span class="m">3</span><span class="o">:</span> <span class="m">7</span><span class="p">,</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Eventually I came to realise that during the <em>refactor</em> phase (recall <a href="#the-method">the method</a>) our main goal (according to TDD) is to remove duplication: duplication within the implementation itself, and duplication between the implementation <em>and the tests</em>. In the example above, <code class="language-plaintext highlighter-rouge">2</code>, <code class="language-plaintext highlighter-rouge">3</code>, <code class="language-plaintext highlighter-rouge">4</code>, and <code class="language-plaintext highlighter-rouge">7</code> are duplicated between the implementation and the test code. We <em>could</em> write constants for each of those values, but then we would just be duplicating the names of the constants in several places. It is then that I realised that <code class="language-plaintext highlighter-rouge">return a + b</code> leads to the least duplication overall in the codebase. Having gotten there, what’s to stop us from deleting one of the tests? And now we’re back at step A.</p><p>… and <em>that</em> is a level of nuance absent in most conversations about TDD that I’ve seen.</p><h2 id="obvious-implementation"><span class="mr-2">Obvious Implementation</span><a href="#obvious-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The answer to the conundrum above: if the implementation is sufficiently obvious to you (eg. <code class="language-plaintext highlighter-rouge">Add</code>) then just implement it. There is no need for fake implementations or runarounds with triangulation.</p><p>… or so they say. Things get tricky while pair-programming: is the implementation also obvious to your pairing partner? How large is the gap between skill and experience levels?</p><h2 id="one-to-many"><span class="mr-2">One to Many</span><a href="#one-to-many" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>How do you implement an operation that works with collections of objects? Implement it without collections first, then make it work with collections.</p></blockquote><p>A little too prescriptive if you ask me.</p><h1 id="questions">Questions</h1><p>Questions selected from chapter 32 <em>Mastering TDD</em>.</p><h2 id="how-large-should-my-steps-be"><span class="mr-2">How large should my steps be?</span><a href="#how-large-should-my-steps-be" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Chapter 32 <em>Mastering TDD</em> provides some guidance. The book stops short of making strong claims, but the general recommendation seems to be to go small. Ultimately the size of the steps is up to you and your tolerance level. You get hints of this flexibility in the choice between <em>Obvious Implementation</em> and <em>Fake It</em> in <a href="#the-method">The Method</a> above.</p><blockquote><p>When I use TDD in practice, I commonly shift between these two modes […]. When everything is going smoothly and I know what to type, I put in Obvious Implementation after Obvious Implementation (running the tests each time to ensure that what’s obvious to me is still obvious to the computer). As soon as I get an unexpected red bar, I back up, shift to faking implementations, and refactor to the right code. When my confidence returns, I go back to Obvious Implementation.</p><p>Chapter 2: <em>Degenerate Objects</em>.</p></blockquote><h2 id="what-dont-you-have-to-test"><span class="mr-2">What don’t you have to test?</span><a href="#what-dont-you-have-to-test" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The gist is:</p><blockquote><p>Write tests until fear is transformed into boredom.</p></blockquote><p>Simple list:</p><ul><li>Conditionals<li>Loops<li>Operations<li>Polymorphism</ul><h2 id="how-do-you-know-if-you-have-good-tests"><span class="mr-2">How do you know if you have good tests?</span><a href="#how-do-you-know-if-you-have-good-tests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Attributes of tests that suggest a design is in trouble:</p><ul><li>Long setup code<li>Setup duplication<li>Long running tests<li>Fragile tests<ul><li>Note: different from flaky tests. These are tests with hidden or unexpected coupling to other parts of the system.</ul></ul><h2 id="how-does-tdd-lead-to-frameworks"><span class="mr-2">How does TDD lead to frameworks?</span><a href="#how-does-tdd-lead-to-frameworks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>TDD focuses on the realities of <em>today</em>, discarding everything else (YAGNI).</p><blockquote><p>Code for tomorrow, design for today.</p></blockquote><p>Presumably what happens with TDD in practice is that removal of duplication along with respect for SOLID principles (“Open/Closed” was the only one mentioned here) leads to a natural evolution of the system’s design where changes are effected only in specific spots as needed. There is an amusing statement here:</p><blockquote><p>At the limit, where you introduce the variations very quickly, TDD is indistinguishable from designing ahead.</p></blockquote><p>This is just YAGNI stated in a different way.</p><h2 id="how-much-feedback-do-you-need"><span class="mr-2">How much feedback do you need?</span><a href="#how-much-feedback-do-you-need" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In other words, <em>how many test cases should I test for?</em></p><p>The answer is, it depends. Here are some questions to guide you:</p><ul><li>What are the chances of some weird edge cases occurring?<li>What would be the impact of these edge cases?<li>What is our target <a href="https://en.wikipedia.org/wiki/Mean_time_between_failures">Mean Time Between Failure</a> rate?</ul><p>Here is a tantalizing paragraph (emphasis mine):</p><blockquote><p>TDD’s view of testing is pragmatic. In TDD, the tests are a means to an end - the end being code in which we have great confidence. <strong>If our knowledge of the implementation gives us confidence even without a test, then we will not write that test.</strong> Black box testing, where we deliberately choose to ignore the implementation, has some advantages. By ignoring the code, it demonstrates a different value system - the tests are valuable alone.</p></blockquote><p>In this quote, if we take in everything up to and including the part in bold, one might conclude that Kent/TDD is OK with programmers choosing not to test certain arbitrary parts of the code. This turns on its head everything we know about testing so far, including the confidence that good tests and test coverage bring when refactoring, making sure everything works, etc. However, the last bit on black box testing makes me think this paragraph is really just talking about the choice of not testing internal implementation details, which I completely understand and generally agree with.</p><h2 id="can-you-drive-development-with-application-level-tests"><span class="mr-2">Can you drive development with application-level tests?</span><a href="#can-you-drive-development-with-application-level-tests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Interesting conundrum.</p><p>The risk with driving development with unit tests is these are only indirectly connected to the actual user story, so we run the risk of implementing a piece that may not actually be needed.</p><p>The obstacle with driving development with application-level tests<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup> is setting up the fixtures, being slower and more difficult to troubleshoot, as well as organizational issues surrounding resource allocation at specific times during the development lifecycle (devs+users) writing tests far in advance of actual development. The dreaded RED bar will stay red for quite a while.</p><h1 id="footnotes">Footnotes</h1><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>See <a href="https://www.amazon.ca/Extreme-Programming-Explained-Embrace-Change/dp/0321278658">Extreme Programming Explained: Embrace Change</a>, also by Kent Beck. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:2" role="doc-endnote"><p>Interesting that <em>Application Test-Driven Development (ATDD)</em> does not seem to come up in search results. I think it’s another term for <a href="https://www.agilealliance.org/glossary/atdd">Acceptance Test Driven Development</a>. The link says Kent mentioned ATDD in this book. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/books/'>books</a>, <a href='/categories/testing/'>testing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/programming/" class="post-tag no-text-decoration" >programming</a> <a href="/tags/testing/" class="post-tag no-text-decoration" >testing</a> <a href="/tags/unit-test/" class="post-tag no-text-decoration" >unit-test</a> <a href="/tags/kent-beck/" class="post-tag no-text-decoration" >kent-beck</a> <a href="/tags/tdd/" class="post-tag no-text-decoration" >tdd</a> <a href="/tags/extreme-programming/" class="post-tag no-text-decoration" >extreme-programming</a> <a href="/tags/xp/" class="post-tag no-text-decoration" >xp</a> <a href="/tags/book/" class="post-tag no-text-decoration" >book</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://t.me/share/url?url=https://georgearisty.dev/posts/test-driven-development-by-example/&amp;text=Test-Driven Development By Example - George Aristy" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://georgearisty.dev/posts/test-driven-development-by-example/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://georgearisty.dev/posts/test-driven-development-by-example/&amp;t=Test-Driven Development By Example - George Aristy" data-toggle="tooltip" data-placement="top" title="Hacker News" target="_blank" rel="noopener" aria-label="Hacker News"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kubectl-plugins/">Plugins I use with kubectl</a><li><a href="/posts/test-driven-development-by-example/">Test-Driven Development By Example</a><li><a href="/posts/ckad/">Certified Kubernetes Application Developer: My Experience</a><li><a href="/posts/clean-architecture/">Clean Architecture: A Craftsman's Guide to Software Structure and Design</a><li><a href="/posts/build-trap/">Escaping the Build Trap: How Effective Product Management Creates Real Value</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/learning-go/">learning-go</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/vim/">vim</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/elegant-objects/">elegant-objects</a></div></div></div><script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/kubernetes-in-action/"><div class="card-body"> <em class="timeago small" data-ts="1669471200" > 2022-11-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kubernetes In Action</h3><div class="text-muted small"><p> Written by Marko Lukša, Kubernetes In Action is a fantastic book covering all operational aspects of Kubernetes. I find it very hard to think of a better book on the subject. This is the first edi...</p></div></div></a></div><div class="card"> <a href="/posts/clean-architecture/"><div class="card-body"> <em class="timeago small" data-ts="1640667600" > 2021-12-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Clean Architecture: A Craftsman's Guide to Software Structure and Design</h3><div class="text-muted small"><p> Written by Robert C. Martin (a.k.a. “Uncle Bob”), Clean Architecture: A Craftsman’s Guide to Software Structure and Design offers guidance on how to engineer your software product’s architecture -...</p></div></div></a></div><div class="card"> <a href="/posts/build-trap/"><div class="card-body"> <em class="timeago small" data-ts="1641066600" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Escaping the Build Trap: How Effective Product Management Creates Real Value</h3><div class="text-muted small"><p> Written by Melissa Perri, Escaping the Build Trap: How Effective Product Management Creates Real Value essentially re-architects the software development lifecycle by anchoring it on actionable fe...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/golang-panics/" class="btn btn-outline-primary" prompt="Older"><p>Golang Guild Session: Panics</p></a> <a href="/posts/golang-concurrency-primitives/" class="btn btn-outline-primary" prompt="Newer"><p>Golang Guild Session: Concurrency Primitives</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "llorllale/llorllale.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnk4MDM1Mjk5Ng==", "data-category": "Announcements", "data-category-id": "DIC_kwDOBMoW5M4COm92", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/georgearisty">George Aristy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/learning-go/">learning-go</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/vim/">vim</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/elegant-objects/">elegant-objects</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="/assets/lib/simple-jekyll-search-1.10.0/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/lib/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/lozad-1.16.0/lozad.min.js"></script> <script src="/assets/lib/clipboard-2.0.9/clipboard.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/dayjs.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/locale/en.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/lib/bootstrap-4.6.1/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-P9Y4YYSCTS"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-P9Y4YYSCTS'); }); </script>
