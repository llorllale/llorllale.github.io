<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Clean Architecture: A Craftsman’s Guide to Software Structure and Design" /><meta name="author" content="George Aristy" /><meta property="og:locale" content="en_US" /><meta name="description" content="Written by Robert C. Martin (a.k.a. “Uncle Bob”), Clean Architecture: A Craftsman’s Guide to Software Structure and Design offers guidance on how to engineer your software product’s architecture - composed of many components and modules, and the relations between them - in order to “minimize the human resources required to build and maintain the required system”." /><meta property="og:description" content="Written by Robert C. Martin (a.k.a. “Uncle Bob”), Clean Architecture: A Craftsman’s Guide to Software Structure and Design offers guidance on how to engineer your software product’s architecture - composed of many components and modules, and the relations between them - in order to “minimize the human resources required to build and maintain the required system”." /><link rel="canonical" href="https://georgearisty.dev/posts/clean-architecture/" /><meta property="og:url" content="https://georgearisty.dev/posts/clean-architecture/" /><meta property="og:site_name" content="George Aristy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-28T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Clean Architecture: A Craftsman’s Guide to Software Structure and Design" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@George Aristy" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"George Aristy"},"dateModified":"2022-11-26T09:29:20-05:00","datePublished":"2021-12-28T00:00:00-05:00","description":"Written by Robert C. Martin (a.k.a. “Uncle Bob”), Clean Architecture: A Craftsman’s Guide to Software Structure and Design offers guidance on how to engineer your software product’s architecture - composed of many components and modules, and the relations between them - in order to “minimize the human resources required to build and maintain the required system”.","headline":"Clean Architecture: A Craftsman’s Guide to Software Structure and Design","mainEntityOfPage":{"@type":"WebPage","@id":"https://georgearisty.dev/posts/clean-architecture/"},"url":"https://georgearisty.dev/posts/clean-architecture/"}</script><title>Clean Architecture: A Craftsman's Guide to Software Structure and Design | George Aristy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="George Aristy"><meta name="application-name" content="George Aristy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="/assets/lib/bootstrap-4.6.1/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free-5.15.4/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup-1.1.0/magnific-popup.css"> <script src="/assets/lib/jquery-3.6.0/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/portrait.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">George Aristy</a></div><div class="site-subtitle font-italic">Blog about software craftmanship</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/bookshelf/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKSHELF</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/talks/" class="nav-link"> <i class="fa-fw fas fa-comment ml-xl-3 mr-xl-3 unloaded"></i> <span>TALKS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/llorllale" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['george.aristy','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/georgearisty/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/1623885/george-aristy" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Clean Architecture: A Craftsman's Guide to Software Structure and Design</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Clean Architecture: A Craftsman's Guide to Software Structure and Design</h1><div class="post-meta text-muted"><div> By <em> <a href="https://www.linkedin.com/in/georgearisty">George Aristy</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1640667600" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-12-28 </em> </span> <span> Updated <em class="timeago" data-ts="1669472960" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-11-26 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2056 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 300'%3E%3C/svg%3E" data-src="/assets/img/clean-architecture.jpg" alt="book cover" class="left" height="300" width="200" data-proofer-ignore> Written by Robert C. Martin (a.k.a. “Uncle Bob”), <a href="https://www.amazon.ca/gp/product/0134494164">Clean Architecture: A Craftsman’s Guide to Software Structure and Design</a> offers guidance on how to engineer your software product’s architecture - composed of many components and modules, and the relations between them - in order to “minimize the human resources required to build and maintain the required system”.</p><p>Following are some notes I took after reading the book. Rather than be the end all, be all, this is intended to be a living document with notes and annotations added as my understanding grows.</p><p><em>Check out some other books I’ve read on the <a href="/bookshelf/">bookshelf</a>.</em></p><h1 id="summary">Summary</h1><p><em>Clean Architecture</em> lays out recommendations for the high-level structure and ordering of system components (Java jars, Go modules) in a way that isolates changes in individual modules and minimizing disruptions in the rest. This is accomplished by isolating components implementing critical business policies from lower-level details like persistence layers or UI components by having the latter depend on the former and not the other way around (<strong>Dependency Inversion</strong> and the <strong>Dependency Rule</strong>).</p><p>Although clearly aware of “entities” and “business logic”, <em>Clean Architecture</em> does not delve into the details of the process of determining what logic should be “business logic” vs. what shouldn’t be; for that I think the reader should head towards more specialized resources such as Eric Evan’s <a href="https://www.amazon.ca/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215">Domain Driven Design: Tackling Complexity in the Heart of Software</a>.</p><p>Nevertheless, <em>Clean Architecture</em> steers the reader into thinking about software features in an “inside-out” manner: figure out the core business logic, then figure out the use cases, then plug in the rest of the details like the database repositories, external service calls, and view components. This is a fantastic way of thinking about software design and I wish more teams would adopt this mindset.</p><h1 id="the-goal-of-clean-architecture">The goal of clean architecture</h1><blockquote><p>The goal of software architecture is to minimize the human resources required to build and maintain the required system.</p><p><em>Chapter I: What is Design and Architecture?</em></p></blockquote><p>The goal is achieved by identifying the components that are expected to change frequently versus those that are relatively stable. The axis of stability is a range of degrees, not a binary condition.</p><p>The predominant concept at work is the <em>Dependency Rule</em> by far.</p><h1 id="what-are-components">What are components?</h1><blockquote><p>Components are units of deployment. They are the smallest entities that can be deployed as part of a system. In Java, they are .jar files. In Ruby, they are gem files. In .Net, they are DLLs. In compiled languages, they are aggregations of binary files. In interpreted languages, they are aggregations of source files. In all languages, they are the granule of deployment.</p><p><em>Chapter 12: Components</em></p></blockquote><p>As per this definition, a “component” in Go would be a <a href="https://go.dev/doc/code#Organization">module</a>.</p><h1 id="what-are-modules">What are modules?</h1><blockquote><p>The simplest definition is just a source file. […] a module is a cohesive set of functions and data structures.</p><p><em>Chapter 7: The Single Responsibility Principle</em></p></blockquote><p>As per this definition, a Java “module” would be a class whereas the Go analog is a <a href="https://go.dev/doc/code#Organization">package</a>.</p><h1 id="solid-principles">SOLID Principles</h1><p>Part III <em>Design Principles</em> is devoted to a recap of <a href="https://en.wikipedia.org/wiki/SOLID">SOLID principles</a> and how they “arrange our functions and data structures into classes, and how those classes should be interconnected.”</p><p><em>SOLID principles are employed at the module level.</em></p><p>Uncle Bob wrote previously extensively about SOLID principles in <a href="https://www.amazon.ca/Software-Development-Principles-Patterns-Practices/dp/0135974445">Agile Software Development: Principles, Patterns, and Practices</a>. The book is on my reading TODO list.</p><p>Of the five principles, perhaps the most relevant one to <em>Clean Architecture</em> is the Dependency Inversion Principle (chapter 11) since it provides the single most important tool an architect can employ to isolate stable components from changes in unstable ones and is directly related to the <em>Dependency Rule</em>.</p><h1 id="what-modules-go-in-which-components">What modules go in which components?</h1><p>From Chapter 13: Component Cohesion:</p><pre><code class="language-mermaid">flowchart LR
    rep((REP:\nGroup for\nreusers))
    ccp((CCP:\ngroup for\nmaintenance))
    crp((CRP:\nSplit to avoid\nunneeded\nreleases))
    rep -- Too many unneeded releases --- ccp
    ccp -- Hard to reuse --- crp
    crp -- Too many components change --- rep
</code></pre><p><em>Chapter13, figure 13.1: Cohesion principles tension diagram</em></p><p>The edges describe the cost of abandoning the principle on the opposite vertex.</p><h2 id="the-reuserelease-equivalence-principle-rep"><span class="mr-2">The Reuse/Release Equivalence Principle (REP)</span><a href="#the-reuserelease-equivalence-principle-rep" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>The granule of reuse is the granule of release.</p><p><em>Chapter 13: Component Cohesion</em></p></blockquote><p>Clearly under-defined. Uncle Bob even admits the advice is weak. Appears to say that release snapshots should be provided for components and that their classes and modules must belong to a cohesive group. I agree and recognize tautology when I see it.</p><h2 id="the-common-closure-principle-ccp"><span class="mr-2">The Common Closure Principle (CCP)</span><a href="#the-common-closure-principle-ccp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Gather into components those classes that change for the same reasons and at the same times. Separate into different components those classes that change at different times and for different reasons.</p></blockquote><h2 id="the-common-reuse-principle-crp"><span class="mr-2">The Common Reuse Principle (CRP)</span><a href="#the-common-reuse-principle-crp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Don’t force users of a component to depend on things they don’t need.</p></blockquote><p>Uncle Bob argues surprisingly strong about this principle, further saying things like:</p><blockquote><p>Thus when we depend on a component, we want to make sure we depend on every class in that component.</p></blockquote><p>In the modern software development world of downloadable and reusable libraries and APIs, this seems like a very strong statement to make. Should we make sure we use every single feature of something like <a href="https://github.com/spf13/cobra">spf13/cobra</a> or should we reinvent the wheel? Then again, with the recent <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44832">log4j vulnerabilities</a> in mind, the wisdom behind Uncle Bob’s argument is apparent. It seems difficult to choose one or the other.</p><h1 id="how-do-we-manage-coupling-between-components">How do we manage coupling between components?</h1><p>In short, use <strong>The Dependency Rule</strong>.</p><h2 id="what-is-the-dependency-rule"><span class="mr-2">What is the Dependency Rule?</span><a href="#what-is-the-dependency-rule" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Source code dependencies must point only inward, toward higher-level policies.</p><p><em>Chapter 22: The Clean Architecture</em></p></blockquote><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3C/svg%3E" data-src="/assets/img/clean-architecture-onion.jpg" alt="onion" height="300" width="400" data-proofer-ignore> <em>Chapter 22, Figure 22.1: The clean architecture. This image instance was copied from Uncle Bob’s article <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">here</a>.</em></p><p>A pet peeve of mine is when people pretend this image explains itself. It doesn’t. There’s a lot to unpack in just the terms alone (“use cases”, “controllers”, “ports”, “flow of control”) that you basically have to read the book to properly understand it. Here’s my take:</p><h2 id="explaining-the-clean-onion-diagram"><span class="mr-2">Explaining the Clean Onion Diagram</span><a href="#explaining-the-clean-onion-diagram" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>Concentric circles</strong></p><ul><li><code class="language-plaintext highlighter-rouge">Entities</code>: are where “enterprise business rules” are implemented. These are the “high-level policies” Uncle Bob keeps mentioning elsewhere. I don’t know why he chose a different term here. Enterprise business rules are those implemented by the business whether the software system exists or not. Reference: section <strong>Entities</strong>, Chapter 20, <em>Business Rules</em>.<li><code class="language-plaintext highlighter-rouge">Use Cases</code>: implement the application-specific business rules. These allow the automated software to implement the enterprise business rules correctly. Example: after using enterprise business rules to determine whether a customer is applicable for a loan, the banking application may then use application business rules to determine whether the loan estimation screen should be displayed or not. Reference: section <strong>Use Cases</strong>, Chapter 20, <em>Business Rules</em>.<li><code class="language-plaintext highlighter-rouge">Controllers</code>/<code class="language-plaintext highlighter-rouge">Presenters</code>/<code class="language-plaintext highlighter-rouge">Gateways</code>: these are generally the “outer fringes” of your system. They adapt inputs from the outside world into messages the use cases can understand, and in turn adapt responses from the use cases into outputs for the world.<ul><li><code class="language-plaintext highlighter-rouge">Controllers</code>: very similar to the controller in the <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC design pattern</a> except it hands control off to the use case (a policy-driven component), not a data structure. See <em>A Typical Scenario</em>, chapter 22, <em>Clean Architecture</em>.<li><code class="language-plaintext highlighter-rouge">Presenters</code>: not to be confused with the MVC <code class="language-plaintext highlighter-rouge">View</code>. These adapt the use case response into a view model. See <em>A Typical Scenario</em>, chapter 22, <em>Clean Architecture</em>.<li><code class="language-plaintext highlighter-rouge">Gateways</code>: these are commonly termed “clients” for external systems - think “database repository” or “web service client”. See <em>Database Gateways</em>, chapter 23, <em>Presenters and Humble Objects</em>.</ul><li>The outer blue layer are your web frameworks, your dependency injection frameworks, your database drivers, etc.</ul><p>The fact that the green and blue layers have different labels makes the diagram confusing.</p><p><strong>Eastward horizontal arrows</strong></p><p>The eastward horizontal arrows connecting layers of the onion represent the direction of source code dependencies. Eg. something in <code class="language-plaintext highlighter-rouge">DB</code> uses or implements something in <code class="language-plaintext highlighter-rouge">Gateways</code>. In turn, something in the latter uses or implements something <code class="language-plaintext highlighter-rouge">Use Cases</code>. Something in <code class="language-plaintext highlighter-rouge">Use Cases</code> uses or implements something in <code class="language-plaintext highlighter-rouge">Entities</code>. Source code dependencies are made to point inward, counter to the direction of control, following the dependency inversion principle.</p><p><strong>Diagram lower-right corner</strong></p><p>This is a bit of an interesting diagram because it depicts a pattern hardly ever seen in the wild: a <code class="language-plaintext highlighter-rouge">Controller</code> captures an incoming message from the outside world and passes it to a <code class="language-plaintext highlighter-rouge">Use Case</code>. The <code class="language-plaintext highlighter-rouge">Use Case</code> produces a response that is handed over to a <code class="language-plaintext highlighter-rouge">Presenter</code>, <strong>not</strong> the <code class="language-plaintext highlighter-rouge">Controller</code>. I suspect this is a rare pattern because of the popularity of using the web as transport with the browser as the client, and the prevalence and ease of use of web frameworks.</p><p>Typical pattern in Go:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c">// handleCreateOrders is our Controller</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">Handler</span><span class="p">)</span> <span class="n">handleCreateOrders</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">request</span> <span class="o">:=</span> <span class="n">parseRequest</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="c">// adapt incoming message to a structure defined by the use case</span>
  
  <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">h</span><span class="o">.</span><span class="n">ordersUseCase</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">"internal error"</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusInternalServerError</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  
  <span class="n">response</span> <span class="o">:=</span> <span class="n">marshal</span><span class="p">(</span><span class="n">mapResponse</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="c">// adapt use case result into view model</span>
  
  <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="c">// send the view model</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="c">// log error</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Pattern prescribed in <em>Clean Architecture</em>:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c">// handleCreateOrders is our Controller</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">Handler</span><span class="p">)</span> <span class="n">handleCreateOrders</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">request</span> <span class="o">:=</span> <span class="n">parseRequest</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="c">// adapt incoming message to a structure defined by the use case</span>
  
  <span class="c">// In this case `presenter` is a function injected into `Handler` that constructs `Presenter` implementations.</span>
  <span class="c">// The presenter maps results and errors into the appropriate view models and sends them back to the client.</span>
  <span class="n">h</span><span class="o">.</span><span class="n">ordersUseCase</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">presenter</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Here’s what Uncle Bob calls a “typical scenario”:</p><p><img data-src="/assets/img/clean-architecture-typical-scenario.jpg" alt="typical" data-proofer-ignore> <em>Chapter 22, Figure 22.2: A typical scenario for a web-based Java system utilizing a database</em></p><h2 id="foundations-of-the-dependency-rule"><span class="mr-2">Foundations of the Dependency Rule</span><a href="#foundations-of-the-dependency-rule" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="the-stable-dependencies-principle"><span class="mr-2">The Stable Dependencies Principle</span><a href="#the-stable-dependencies-principle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>Depend in the direction of stability.</p><p><em>Chapter 14: Component Coupling</em></p></blockquote><h3 id="what-is-meant-by-stability"><span class="mr-2">What is meant by “stability”?</span><a href="#what-is-meant-by-stability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>A stable component is one that does not depend on other components yet many others depend on it.</p><p>Instability of a component:</p>\[I = \frac{Fan^{out}}{Fan^{in} + Fan^{out}} ; I \in [0, 1]\]<p>Where:</p><ul><li>\(I\): instability<li>\(Fan^{out}\): outgoing dependencies. Number of classes inside this component that depend on classes outside the component.<li>\(Fan^{in}\): incoming dependencies. Number of classes outside this component that depend on classes within the component.</ul><p>Building a tool that lets you visualize instabilities of components in a code base would be a neat little project.</p><h3 id="the-stable-abstractions-principle"><span class="mr-2">The Stable Abstractions Principle</span><a href="#the-stable-abstractions-principle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>A component should be as abstract as it is stable.</p><p><em>Chapter 14: Component Coupling</em></p></blockquote><p><img data-src="/assets/img/stability_abstraction.svg" alt="stability-abstraction" data-proofer-ignore></p><p>Makes sense when you think about it. Nothing is more abstract than an interface type. Everything depends on it, yet it depends on nothing (\(I = 1\)).</p><p>High-level policies are put into stable components. Since 100% abstract components (like interfaces) cannot implement policies (only declare them), the best classes would be abstract ones. Abstract classes are also extensible which imparts the necessary flexibility when these policies change.</p><p>Go does not have classes. In Go, high-level policies would be implemented by struct types that depend on interface abstractions of more unstable components. This aligns very well with the Go convention of <a href="https://github.com/golang/go/wiki/CodeReviewComments#interfaces">declaring interfaces where they are used</a>, not where the implementations reside<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p><p><em>Clean Architecture</em> identifies abstract components as the place where high-level business policies should go, and provides simple formulas for measuring how abstract or stable they are. It does not inform the reader of how to identify those policies. For that you would head to another resource such as Eric Evan’s <a href="https://www.amazon.ca/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215">Domain Driven Design: Tackling Complexity in the Heart of Software</a>.</p><p>Uncle Bob does provide some rules of thumb though:</p><blockquote><p>Source code dependencies always point in the same direction across the boundary and always towards the higher-level component.</p><p><em>Chapter 18: Boundary Anatomy</em></p></blockquote><p>From Chapter 19 <em>Policy and Level</em> we also gather that the further a policy is from both inputs and outputs of the system, the higher its level.</p><h3 id="how-do-components-communicate-with-each-other"><span class="mr-2">How do components communicate with each other?</span><a href="#how-do-components-communicate-with-each-other" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Emphasis mine:</p><blockquote><p>[…] the data that crosses the boundaries consists of simple data structures. […] <strong>We don’t want to cheat and pass entity objects or database rows.</strong> We don’t want the data structures to have any kind of dependency that violates the Dependency Rule.</p></blockquote><h1 id="footnotes">Footnotes</h1><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>Be careful and thoughtful with this. There is a lot of dogma in the Go community. There are plenty of exceptions to this rule. Examples: decorator pattern, first class polymorphic types. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/books/'>books</a>, <a href='/categories/architecture/'>architecture</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/clean-architecture/" class="post-tag no-text-decoration" >clean-architecture</a> <a href="/tags/uncle-bob/" class="post-tag no-text-decoration" >uncle-bob</a> <a href="/tags/book/" class="post-tag no-text-decoration" >book</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://t.me/share/url?url=https://georgearisty.dev/posts/clean-architecture/&amp;text=Clean Architecture: A Craftsman&#39;s Guide to Software Structure and Design - George Aristy" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://georgearisty.dev/posts/clean-architecture/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://georgearisty.dev/posts/clean-architecture/&amp;t=Clean Architecture: A Craftsman&#39;s Guide to Software Structure and Design - George Aristy" data-toggle="tooltip" data-placement="top" title="Hacker News" target="_blank" rel="noopener" aria-label="Hacker News"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kubectl-plugins/">Plugins I use with kubectl</a><li><a href="/posts/test-driven-development-by-example/">Test-Driven Development By Example</a><li><a href="/posts/ckad/">Certified Kubernetes Application Developer: My Experience</a><li><a href="/posts/clean-architecture/">Clean Architecture: A Craftsman's Guide to Software Structure and Design</a><li><a href="/posts/build-trap/">Escaping the Build Trap: How Effective Product Management Creates Real Value</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/learning-go/">learning-go</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/vim/">vim</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/elegant-objects/">elegant-objects</a></div></div></div><script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/test-driven-development-by-example/"><div class="card-body"> <em class="timeago small" data-ts="1650119400" > 2022-04-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Test-Driven Development By Example</h3><div class="text-muted small"><p> Written by Kent Beck, Test-Driven Development By Example explains how TDD works by way of 2 examples: first building piece by piece a toy Money class, then the initial scaffolds of xUnit. The thir...</p></div></div></a></div><div class="card"> <a href="/posts/kubernetes-in-action/"><div class="card-body"> <em class="timeago small" data-ts="1669471200" > 2022-11-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kubernetes In Action</h3><div class="text-muted small"><p> Written by Marko Lukša, Kubernetes In Action is a fantastic book covering all operational aspects of Kubernetes. I find it very hard to think of a better book on the subject. This is the first edi...</p></div></div></a></div><div class="card"> <a href="/posts/build-trap/"><div class="card-body"> <em class="timeago small" data-ts="1641066600" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Escaping the Build Trap: How Effective Product Management Creates Real Value</h3><div class="text-muted small"><p> Written by Melissa Perri, Escaping the Build Trap: How Effective Product Management Creates Real Value essentially re-architects the software development lifecycle by anchoring it on actionable fe...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/golang-generics-first-look/" class="btn btn-outline-primary" prompt="Older"><p>Golang - First look at generics</p></a> <a href="/posts/build-trap/" class="btn btn-outline-primary" prompt="Newer"><p>Escaping the Build Trap: How Effective Product Management Creates Real Value</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "llorllale/llorllale.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnk4MDM1Mjk5Ng==", "data-category": "Announcements", "data-category-id": "DIC_kwDOBMoW5M4COm92", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/georgearisty">George Aristy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/learning-go/">learning-go</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/vim/">vim</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/elegant-objects/">elegant-objects</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="/assets/lib/mermaid-8.13.10/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="/assets/lib/simple-jekyll-search-1.10.0/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/lib/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/lozad-1.16.0/lozad.min.js"></script> <script src="/assets/lib/clipboard-2.0.9/clipboard.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/dayjs.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/locale/en.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="/assets/lib/polyfill-v3-es6/polyfill.min.js"></script> <script id="MathJax-script" async src="/assets/lib/mathjax-3.2.0/tex-chtml.js"> </script> <script src="/assets/lib/bootstrap-4.6.1/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-P9Y4YYSCTS"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-P9Y4YYSCTS'); }); </script>
