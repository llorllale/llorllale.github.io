<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Golang - First look at generics" /><meta name="author" content="George Aristy" /><meta property="og:locale" content="en_US" /><meta name="description" content="This post is part of a series where I do my best to organize my thoughts around Go: its paradigms and usability as a programming language. I write this as a Java programmer that respects the principles of Elegant Objects." /><meta property="og:description" content="This post is part of a series where I do my best to organize my thoughts around Go: its paradigms and usability as a programming language. I write this as a Java programmer that respects the principles of Elegant Objects." /><link rel="canonical" href="https://georgearisty.dev/posts/golang-generics-first-look/" /><meta property="og:url" content="https://georgearisty.dev/posts/golang-generics-first-look/" /><meta property="og:site_name" content="George Aristy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-21T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Golang - First look at generics" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@George Aristy" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"George Aristy"},"dateModified":"2021-12-21T23:56:27-05:00","datePublished":"2021-12-21T00:00:00-05:00","description":"This post is part of a series where I do my best to organize my thoughts around Go: its paradigms and usability as a programming language. I write this as a Java programmer that respects the principles of Elegant Objects.","headline":"Golang - First look at generics","mainEntityOfPage":{"@type":"WebPage","@id":"https://georgearisty.dev/posts/golang-generics-first-look/"},"url":"https://georgearisty.dev/posts/golang-generics-first-look/"}</script><title>Golang - First look at generics | George Aristy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="George Aristy"><meta name="application-name" content="George Aristy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="/assets/lib/bootstrap-4.6.1/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free-5.15.4/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup-1.1.0/magnific-popup.css"> <script src="/assets/lib/jquery-3.6.0/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/portrait.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">George Aristy</a></div><div class="site-subtitle font-italic">Blog about software craftmanship</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/bookshelf/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKSHELF</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/talks/" class="nav-link"> <i class="fa-fw fas fa-comment ml-xl-3 mr-xl-3 unloaded"></i> <span>TALKS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/llorllale" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['george.aristy','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/georgearisty/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/1623885/george-aristy" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Golang - First look at generics</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img data-src="/assets/img/gopher_peek.png" class="preview-img bg" alt="Preview Image" data-proofer-ignore><h1 data-toc-skip>Golang - First look at generics</h1><div class="post-meta text-muted"><div> By <em> <a href="https://www.linkedin.com/in/georgearisty">George Aristy</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1640062800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-12-21 </em> </span> <span> Updated <em class="timeago" data-ts="1640148987" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-12-21 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1830 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p><em>This post is part of a <a href="/tags/learning-go">series</a> where I do my best to organize my thoughts around Go: its paradigms and usability as a programming language. I write this as a Java programmer that respects the principles of <a href="https://www.elegantobjects.org/">Elegant Objects</a>.</em></p><p><a href="https://go.dev/blog/go1.18beta1">Go 1.18 Beta 1 was just released</a>. These are my initial impressions of the main feature to be delivered in this release: generics.</p><h2 id="syntax"><span class="mr-2">Syntax</span><a href="#syntax" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Go’s syntax possesses a very similar structure to Java’s:</p><p><strong>Go</strong></p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c">// A function.</span>
<span class="k">func</span> <span class="n">Print</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"printing type: %T</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// A type.</span>
<span class="k">type</span> <span class="n">Tree</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">*</span><span class="n">Tree</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
    <span class="n">data</span>  <span class="n">T</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Java</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// A function.</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"printing type: "</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
<span class="o">}</span>

<span class="c1">// A type.</span>
<span class="kd">class</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">;</span>
    <span class="kd">private</span> <span class="no">T</span> <span class="n">data</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>One difference: Go requires the type parameter to be explicitly constrained by a type (eg.: <code class="language-plaintext highlighter-rouge">T any</code>) whereas Java does not (<code class="language-plaintext highlighter-rouge">T</code> on its own is implicitly inferred as a <code class="language-plaintext highlighter-rouge">java.lang.Object</code>). Failing to provide the constraint in Go will result in an error similar to the following:</p><blockquote><p>./prog.go:95:13: syntax error: missing type constraint</p></blockquote><p>I suspect the difference lies in Java’s unified type hierarchy (every thing is a <code class="language-plaintext highlighter-rouge">java.lang.Object</code>). Go possesses no such model.</p><h2 id="type-switch"><span class="mr-2">Type Switch</span><a href="#type-switch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The following compile error surprised me:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="nb">print</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">t</span><span class="o">.</span><span class="p">(</span><span class="k">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="kt">string</span><span class="o">:</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"printing a string: "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="c">// error: cannot use type switch on type parameter value t (variable of type T constrained by any)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>… since the following is legal Go code:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="nb">print</span><span class="p">(</span><span class="n">t</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">t</span><span class="o">.</span><span class="p">(</span><span class="k">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="kt">string</span><span class="o">:</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"printing a string: "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This would appear to mean that <code class="language-plaintext highlighter-rouge">any</code> is not simply an alias for <code class="language-plaintext highlighter-rouge">interface{}</code> as declared by Robert Griesemer and Ian Lance Taylor in <a href="https://youtu.be/35eIxI_n5ZM?t=2477">this talk</a>. This was raised in <a href="https://github.com/golang/go/issues/49206">this issue</a> that points to <a href="https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md#why-not-permit-type-assertions-on-values-whose-type-is-a-type-parameter">this rationale</a> in an earlier draft of the proposal. This is especially surprising on union type parameters:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="nb">print</span><span class="p">[</span><span class="n">T</span> <span class="kt">int64</span><span class="o">|</span><span class="kt">float64</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">t</span><span class="o">.</span><span class="p">(</span><span class="k">type</span><span class="p">)</span> <span class="p">{</span> <span class="c">// error: cannot use type switch on type parameter value t (variable of type T constrained by int64|float64)</span>
        <span class="k">case</span> <span class="kt">int64</span><span class="o">:</span>   <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"printing an int64: "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">case</span> <span class="kt">float64</span><span class="o">:</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"printing a float64: "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>While looking at the comments in this and related issues I get impression there’s a decent chance that type-switching on type parameters will be possible in the future. Just not in 1.18. To work around this, assign <code class="language-plaintext highlighter-rouge">t</code> to a variable of type <code class="language-plaintext highlighter-rouge">interface{}</code> and type-switch on that.</p><p>In the meantime, here’s the same feature in Java (combining <a href="https://openjdk.java.net/jeps/361">switch expressions</a> from Java 14 and <a href="https://openjdk.java.net/jeps/406">pattern matching for switch expressions (preview)</a> in Java 17):</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">String</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"you sent string: "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
        <span class="k">default</span>       <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"you sent an unknown type: "</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">};</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="type-constraints"><span class="mr-2">Type Constraints</span><a href="#type-constraints" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In Go, the type parameter constraint <code class="language-plaintext highlighter-rouge">T any</code> indicates <code class="language-plaintext highlighter-rouge">T</code> is not constrained by any particular interface. In other words, <code class="language-plaintext highlighter-rouge">T</code> implements <code class="language-plaintext highlighter-rouge">interface{}</code> (not quite; see <a href="#type-switch">Type Switch</a>).</p><p>In Go we can further constrain the type set of <code class="language-plaintext highlighter-rouge">T</code> by indicating something other than <code class="language-plaintext highlighter-rouge">any</code>, eg.:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c">// T is now constrained to int types.</span>
<span class="k">type</span> <span class="n">Tree</span><span class="p">[</span><span class="n">T</span> <span class="kt">int</span><span class="p">]</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">*</span><span class="n">Tree</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
    <span class="n">data</span>  <span class="n">T</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Equivalent Java:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">;</span>
    <span class="kd">private</span> <span class="no">T</span> <span class="n">data</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>In Go, type parameter declarations can specify concrete types (like Java) and can be declared inline or referenced:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c">// inlined</span>
<span class="k">func</span> <span class="n">PrintInt64</span><span class="p">[</span><span class="n">T</span> <span class="kt">int64</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// referenced</span>
<span class="k">func</span> <span class="n">PrintInt64</span><span class="p">[</span><span class="n">T</span> <span class="n">Int64Type</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// reusable (like constraints.Integer)</span>
<span class="k">type</span> <span class="n">Bit64Type</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="kt">int64</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="gos-reusable-type-constraints"><span class="mr-2">Go’s reusable type constraints</span><a href="#gos-reusable-type-constraints" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Go’s reusable type constraints are a bit… odd.</p><p>Take this simple example interface <code class="language-plaintext highlighter-rouge">Tester</code>:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">type</span> <span class="n">Tester</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">myTester</span> <span class="k">struct</span> <span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">myTester</span><span class="p">)</span> <span class="n">Test</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">func</span> <span class="n">test</span><span class="p">(</span><span class="n">t</span> <span class="n">Tester</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myTester</span><span class="p">{})</span>
<span class="p">}</span>
</pre></table></code></div></div><p>… then add a type constraint:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">type</span> <span class="n">Tester</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="kt">int64</span>
    <span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">myTester</span> <span class="k">struct</span> <span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">myTester</span><span class="p">)</span> <span class="n">Test</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">func</span> <span class="n">test</span><span class="p">(</span><span class="n">t</span> <span class="n">Tester</span><span class="p">)</span> <span class="p">{</span> <span class="c">// ERROR: interface contains type constraints</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myTester</span><span class="p">{})</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Never mind that <code class="language-plaintext highlighter-rouge">int64</code> does not implement <code class="language-plaintext highlighter-rouge">Tester</code> - the error implies that arguments cannot be of interface types that contain type constraints. This can be demonstrated even when both types implement the same methods:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">type</span> <span class="n">Tester</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">myTester1</span>
    <span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">myTester1</span> <span class="k">struct</span> <span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">myTester1</span><span class="p">)</span> <span class="n">Test</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">type</span> <span class="n">myTester2</span> <span class="k">struct</span> <span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">myTester2</span><span class="p">)</span> <span class="n">Test</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">func</span> <span class="n">test</span><span class="p">(</span><span class="n">t</span> <span class="n">Tester</span><span class="p">)</span> <span class="p">{</span> <span class="c">// ERROR: interface contains type constraints</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myTester1</span><span class="p">{})</span>
<span class="p">}</span>
</pre></table></code></div></div><p>My surprise stems from the reuse of the <code class="language-plaintext highlighter-rouge">interface</code> construct when declaring type constraints. Adding type constraints to an interface changes its nature entirely and limits its uses to generic type parameter declarations only. This will come across as strange to veterans who are used to Go’s structural typing system.</p><h3 id="union-types"><span class="mr-2">Union Types</span><a href="#union-types" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Both Go and Java support union types as type parameters but they do so in very different ways.</p><h4 id="union-types-in-go"><span class="mr-2">Union Types in Go</span><a href="#union-types-in-go" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Go allows union types <strong>for concrete types only</strong>.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c">// GOOD</span>
<span class="k">func</span> <span class="n">PrintInt64OrFloat64</span><span class="p">[</span><span class="n">T</span> <span class="kt">int64</span><span class="o">|</span><span class="kt">float64</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">someStruct</span> <span class="p">{}</span>

<span class="c">// GOOD</span>
<span class="k">func</span> <span class="n">PrintInt64OrSomeStruct</span><span class="p">[</span><span class="n">T</span> <span class="kt">int64</span><span class="o">|*</span><span class="n">someStruct</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"t: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// BAD</span>
<span class="k">func</span> <span class="n">handle</span><span class="p">[</span><span class="n">T</span> <span class="n">io</span><span class="o">.</span><span class="n">Closer</span> <span class="o">|</span> <span class="n">Flusher</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span> <span class="c">// error: cannot use io.Closer in union (interface contains methods)</span>
    <span class="n">err</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">Flush</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"failed to flush: "</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">())</span>
    <span class="p">}</span>

    <span class="n">err</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"failed to close: "</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Flusher</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Flush</span><span class="p">()</span> <span class="kt">error</span>
<span class="p">}</span>
</pre></table></code></div></div><p>It seems like the primary motivation behind Go’s union types (known as <em>type sets</em> in their proposal) is to enable generic operations using operators such as <code class="language-plaintext highlighter-rouge">&lt;</code> on primitive types that support them (source: <a href="https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md#operations-based-on-type-sets">proposal</a>).</p><p>Other examples of type sets are in the <a href="https://github.com/golang/go/blob/2e6e9df2c1242274b02b584c617947aeed39c398/src/constraints/constraints.go#L48"><code class="language-plaintext highlighter-rouge">constraints</code> package</a>.</p><p>To my surprise, it is possible to declare a reusable type constraint that is impossible to satisfy:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">type</span> <span class="n">Tester</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="kt">int</span>    <span class="c">// int does not implement method `Test()`</span>
    <span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">test</span><span class="p">[</span><span class="n">T</span> <span class="n">Tester</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">(</span><span class="n">two</span><span class="p">(</span><span class="m">2</span><span class="p">))</span> <span class="c">// ERROR: two does not implement Tester (possibly missing ~ for int in constraint Tester)</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">two</span> <span class="kt">int</span>

<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">two</span><span class="p">)</span> <span class="n">Test</span><span class="p">()</span> <span class="p">{}</span>
</pre></table></code></div></div><p>The error gives us a clue - use an <a href="https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md#approximation-constraint-element">approximation constraint element</a>:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">type</span> <span class="n">Tester</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="err">~</span><span class="kt">int</span>    <span class="c">// any type alias whose underlying type is an `int` will make do</span>
    <span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">test</span><span class="p">[</span><span class="n">T</span> <span class="n">Tester</span><span class="p">](</span><span class="n">t</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Test</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">(</span><span class="n">two</span><span class="p">(</span><span class="m">2</span><span class="p">))</span> <span class="c">// works</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">two</span> <span class="kt">int</span>

<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="n">two</span><span class="p">)</span> <span class="n">Test</span><span class="p">()</span> <span class="p">{}</span>
</pre></table></code></div></div><p>Approximation constraint elements is about as close to covariance as Go will get in 1.18.</p><h4 id="union-types-in-java"><span class="mr-2">Union Types in Java</span><a href="#union-types-in-java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Java allows union types <strong>for interface types only OR between a non-interface type and an interface type</strong>.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">// GOOD</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Closeable</span> <span class="o">&amp;</span> <span class="nc">Flushable</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">;</span>
    <span class="kd">private</span> <span class="no">T</span> <span class="n">data</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// GOOD</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Number</span> <span class="o">&amp;</span> <span class="nc">Closeable</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">printNumberAndClose</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">intValue</span><span class="o">());</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">t</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"io exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// BAD</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Integer</span> <span class="o">&amp;</span> <span class="nc">Float</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">printIntegerOrFloat</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// error: interface expected here</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span> <span class="c1">// error: ambiguous call</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">isNaN</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p>As alluded to by the <code class="language-plaintext highlighter-rouge">&amp;</code> (“and”) operator, type parameters for union types in Java <strong>must</strong> satisfy all referenced “interfaces”:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">printNumberAndClose</span><span class="o">(</span><span class="k">new</span> <span class="nc">CloseableNumber</span><span class="o">());</span>
      <span class="n">printNumberAndClose</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>                                  <span class="c1">// ERROR: no instance(s) of type variable(s) exist so that Integer conforms to Closeable</span>
      <span class="n">printNumberAndClose</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>    <span class="c1">// ERROR: no instance(s) of type variable(s) exist so that InputStreamReader conforms to Number</span>
  <span class="o">}</span>

  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CloseableNumber</span> <span class="kd">extends</span> <span class="nc">Number</span> <span class="kd">implements</span> <span class="nc">Closeable</span> <span class="o">{</span>
      <span class="c1">// implements methods from Closeable</span>
      <span class="c1">// implements abstract methods from Number</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Number</span> <span class="o">&amp;</span> <span class="nc">Closeable</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">printNumberAndClose</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">intValue</span><span class="o">());</span>

      <span class="k">try</span> <span class="o">{</span>
          <span class="n">t</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"io exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Similar to the Go example above, <code class="language-plaintext highlighter-rouge">printNumberAndClose</code> below will compile even though the conditions of the union type are impossible to satisfy given that <code class="language-plaintext highlighter-rouge">java.lang.Integer</code> is a <code class="language-plaintext highlighter-rouge">final</code> class:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">printNumberAndClose</span><span class="o">(</span><span class="k">new</span> <span class="nc">CloseableNumber</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
      <span class="n">printNumberAndClose</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>                               <span class="c1">// ERROR: no instance(s) of type variable(s) exist so that Integer conforms to Closeable</span>
      <span class="n">printNumberAndClose</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span> <span class="c1">// ERROR: no instance(s) of type variable(s) exist so that InputStreamReader conforms to Integer</span>
  <span class="o">}</span>

  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CloseableNumber</span> <span class="kd">extends</span> <span class="nc">Integer</span> <span class="kd">implements</span> <span class="nc">Closeable</span> <span class="o">{</span> <span class="c1">// ERROR: Cannot inherit from final 'java.lang.Integer'</span>
      <span class="nc">CloseableNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
          <span class="kd">super</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
      <span class="o">}</span>
      
      <span class="c1">// implements methods from Closeable</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Integer</span> <span class="o">&amp;</span> <span class="nc">Closeable</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">printNumberAndClose</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">intValue</span><span class="o">());</span>

      <span class="k">try</span> <span class="o">{</span>
          <span class="n">t</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"io exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Worst that can happen is that nobody will use <code class="language-plaintext highlighter-rouge">printNumberAndClose</code>.</p><h2 id="variance"><span class="mr-2">Variance</span><a href="#variance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Go’s proposal <a href="https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md#comparison-with-java">does not include covariance nor contravariance</a>.</p><p>Java supports both via the use of wildcards:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">// covariance</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sort</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Number</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// sort</span>
<span class="o">}</span>

<span class="c1">// contravariance</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">reverse</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="nc">Number</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// reverse</span>
<span class="o">}</span>
</pre></table></code></div></div><p>I summarized Java’s variance <a href="/posts/java-variance">in a previous blog post</a></p><h2 id="final-thoughts"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Although implementing a subset of Java’s generics features and despite the hackiness of reusable typesets, Go’s proposal is compelling and worthy of trials in real production code once 1.18 rolls around.</p><p>Generics was a sorely missed feature in Go. I look forward to significant savings in lines of code as map/reduce algorithms and data structures are de-duplicated altogether.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/programming/'>programming</a>, <a href='/categories/go/'>go</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/go/" class="post-tag no-text-decoration" >go</a> <a href="/tags/golang/" class="post-tag no-text-decoration" >golang</a> <a href="/tags/generics/" class="post-tag no-text-decoration" >generics</a> <a href="/tags/learning-go/" class="post-tag no-text-decoration" >learning-go</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://t.me/share/url?url=https://georgearisty.dev/posts/golang-generics-first-look/&amp;text=Golang - First look at generics - George Aristy" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://georgearisty.dev/posts/golang-generics-first-look/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://georgearisty.dev/posts/golang-generics-first-look/&amp;t=Golang - First look at generics - George Aristy" data-toggle="tooltip" data-placement="top" title="Hacker News" target="_blank" rel="noopener" aria-label="Hacker News"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kubectl-plugins/">Plugins I use with kubectl</a><li><a href="/posts/test-driven-development-by-example/">Test-Driven Development By Example</a><li><a href="/posts/ckad/">Certified Kubernetes Application Developer: My Experience</a><li><a href="/posts/clean-architecture/">Clean Architecture: A Craftsman's Guide to Software Structure and Design</a><li><a href="/posts/build-trap/">Escaping the Build Trap: How Effective Product Management Creates Real Value</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/learning-go/">learning-go</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/vim/">vim</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/elegant-objects/">elegant-objects</a></div></div></div><script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/golang-methods-on-nil-references/"><div class="card-body"> <em class="timeago small" data-ts="1544385600" > 2018-12-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Golang - methods on nil references</h3><div class="text-muted small"><p> This is the first in a series of posts where I do my best to organize my thoughts around Go: its paradigms and usability as a programming language. I write this as a Java programmer that respects t...</p></div></div></a></div><div class="card"> <a href="/posts/golang-elegant-containers/"><div class="card-body"> <em class="timeago small" data-ts="1545195600" > 2018-12-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Golang - are Elegant Containers possible?</h3><div class="text-muted small"><p> This post is part of a series where I do my best to organize my thoughts around Go: its paradigms and usability as a programming language. I write this as a Java programmer that respects the princi...</p></div></div></a></div><div class="card"> <a href="/posts/golang-elegant-functional-containers/"><div class="card-body"> <em class="timeago small" data-ts="1545195600" > 2018-12-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Golang - another go at elegant containers</h3><div class="text-muted small"><p> This post is part of a series where I do my best to organize my thoughts around Go: its paradigms and usability as a programming language. I write this as a Java programmer that respects the princi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/oauth2-token-bearer-usage/" class="btn btn-outline-primary" prompt="Older"><p>OAuth2 Bearer Token Usage</p></a> <a href="/posts/clean-architecture/" class="btn btn-outline-primary" prompt="Newer"><p>Clean Architecture: A Craftsman's Guide to Software Structure and Design</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "llorllale/llorllale.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnk4MDM1Mjk5Ng==", "data-category": "Announcements", "data-category-id": "DIC_kwDOBMoW5M4COm92", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/georgearisty">George Aristy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/learning-go/">learning-go</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/vim/">vim</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/elegant-objects/">elegant-objects</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="/assets/lib/simple-jekyll-search-1.10.0/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/lib/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/lozad-1.16.0/lozad.min.js"></script> <script src="/assets/lib/clipboard-2.0.9/clipboard.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/dayjs.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/locale/en.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/lib/bootstrap-4.6.1/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-P9Y4YYSCTS"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-P9Y4YYSCTS'); }); </script>
