I"²&<html> <head>&lt;meta http-equiv=Content-Type content="text/html; charset=windows-1252"&gt;<meta name="Generator" content="Microsoft Word 12 (filtered)" /><style><!--  /* Font Definitions */  @font-face  {font-family:"Cambria Math";  panose-1:2 4 5 3 5 4 6 3 2 4;} @font-face  {font-family:Cambria;  panose-1:2 4 5 3 5 4 6 3 2 4;} @font-face  {font-family:Calibri;  panose-1:2 15 5 2 2 2 4 3 2 4;}  /* Style Definitions */  p.MsoNormal, li.MsoNormal, div.MsoNormal  {margin-top:0in;  margin-right:0in;  margin-bottom:10.0pt;  margin-left:0in;  line-height:115%;  font-size:11.0pt;  font-family:"Calibri","sans-serif";} p.MsoTitle, li.MsoTitle, div.MsoTitle  {mso-style-link:"Title Char";  margin-top:0in;  margin-right:0in;  margin-bottom:15.0pt;  margin-left:0in;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst  {mso-style-link:"Title Char";  margin:0in;  margin-bottom:.0001pt;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle  {mso-style-link:"Title Char";  margin:0in;  margin-bottom:.0001pt;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast  {mso-style-link:"Title Char";  margin-top:0in;  margin-right:0in;  margin-bottom:15.0pt;  margin-left:0in;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} a:link, span.MsoHyperlink  {color:blue;  text-decoration:underline;} a:visited, span.MsoHyperlinkFollowed  {color:purple;  text-decoration:underline;} span.TitleChar  {mso-style-name:"Title Char";  mso-style-link:Title;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} .MsoPapDefault  {margin-bottom:10.0pt;  line-height:115%;} @page WordSection1  {size:8.5in 11.0in;  margin:1.0in 1.0in 1.0in 1.0in;} div.WordSection1  {page:WordSection1;} --></style> </head> &lt;body lang=EN-US link=blue vlink=purple&gt; <div class="WordSection1"> <p class="MsoNormal">This tip might save you a few minutes.</p> <p class="MsoNormal">A colleague recently wanted his BPEL process (Oracle SOA Suite) to return a string containing XML markup, and within that markup he needed to include a CDATA section. The requirement for returning this document as a string will perhaps be discussed in another article.</p> <p class="MsoNormal">Short answer: it's not possible.</p> <p class="MsoNormal">Longer answer:</p> <p class="MsoNormal">Those of you who have some experience with [Oracle] BPEL Process development will have probably come across the <i>{ http://schemas.oracle.com/xpath/extension}getContentAsString()</i>function. Those of you who don't: this function enables you to treat an XML structure like a string. It's the only way (that my colleague and I know of) to do this in Oracle BPEL.</p> <p class="MsoNormal">What happens when have some XML structure with a CDATA section, pass it to <i>getContentAsString</i> and assign it to an xsd:string ? The start and end angled brackets (&quot;&lt;&quot; and &quot;&gt;&quot;) pertaining to the CDATA delimiters <i>alone</i> are replaced by their entity references (&quot;&amp;lt;&quot; and &quot;&amp;gt;&quot;). All other markup in the XML structure would be left intact. Why?</p> <p class="MsoNormal">If you only witness this happening via the console audit trails, or basically through any XML parser, you are unlikely to realize that the <i>getContentAsString</i> function actually embeds the XML structure in a CDATA element already!</p> <p class="MsoNormal">What you would see via the online console:</p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">&lt;root&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;ElementList&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element1&gt;data1&lt;/element1&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element2&gt;data2&lt;/element2&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element3&gt;&amp;lt;![CDATA[ some CDATA characters ]]&amp;gt;&lt;/element3&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;/ElementList&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">&lt;/root&gt;</span></p> <p class="MsoNormal">Where the element <i>root</i> is of type xsd:string and is the node to which you're assigning the output of <i>getContentAsString</i>.</p> <p class="MsoNormal">But if you look at the raw message, that is, without parsing the XML data (eg.: soapUI) then you see this:</p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">&lt;root&gt;<b><span style="color:red">&lt;![CDATA[</span></b></span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;ElementList&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element1&gt;data1&lt;/element1&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element2&gt;data2&lt;/element2&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element3&gt;&amp;lt;![CDATA[ some CDATA characters ]]&amp;gt;&lt;/element3&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;/ElementList&gt;<b><span style="color:red">]]&gt;</span></b></span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">&lt;/root&gt;</span></p> <p class="MsoNormal">The <a href="http://www.w3.org/TR/REC-xml/#sec-cdata-sect">XML spec</a> clearly states that CDATA sections cannot be nested. Hence the escaping of those angle brackets. What's more, CDATA sections are not meant to be parsed (that is the point of having CDATA sections), and that includes those escaped characters. Don't go thinking that the XML parser will see them and convert them back to angle brackets.</p> <p class="MsoNormal">So what can you do?</p> <p class="MsoNormal">Don't convert your structure to a string. Return a complex type. If you do so, then you can do something similar to the following in a transformation for example:</p> <p class="MsoNormal" style="line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element3&gt;</span></p> <p class="MsoNormal" style="line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;xsl:text&gt;<b><span style="color:red">&lt;![CDATA[</span></b>&lt;![CDATA[ some CDATA characters ]]<b><span style="color:red">]]&gt;&lt;![CDATA[</span></b>&gt;<b><span style="color:red">]]&gt;</span></b>&lt;/xsl:text&gt;</span></p> <p class="MsoNormal" style="line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;/element3&gt;</span></p> <p class="MsoNormal" style="line-height:normal">By putting that right angle bracket in a separate CDATA section, I avoid &quot;closing&quot; the first CDATA section marked in red so that I can also include those two square brackets &quot;]&quot; in it. The output would be something like this:</p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">&lt;root&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;ElementList&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element1&gt;data1&lt;/element1&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element2&gt;data2&lt;/element2&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;element3&gt;&lt;![CDATA[ some CDATA characters ]]&gt;&lt;/element3&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &lt;/ElementList&gt;</span></p> <p class="MsoNormal" style="margin-left:.5in;line-height:normal"><span style="font-size:9.0pt">&lt;/root&gt;</span></p> <p class="MsoNormal" style="line-height:normal">However, this time the element <i>root</i>is not of type xsd:string; instead, <i>root</i> is now a complex type defined as the parent element of <i>ElementList</i>, itself a complex type having <i>element1</i>, <i>element2</i> and <i>element3</i> as child nodes.</p> <p class="MsoNormal" style="line-height:normal">Hope it helps.</p> </div> &lt;/body&gt; </html>
:ET