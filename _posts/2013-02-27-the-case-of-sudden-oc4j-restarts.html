---
layout: post
title: The Case of Sudden OC4J Restarts [part 1]
date: '2013-02-27T13:33:00.000-04:00'
author: George Aristy
tags: 
modified_time: '2013-04-16T22:15:03.569-04:00'
blogger_id: tag:blogger.com,1999:blog-5903491164319093451.post-8603078839873978693
blogger_orig_url: http://llorllale.blogspot.com/2013/02/the-case-of-sudden-oc4j-restarts.html
---

<html> <head><meta http-equiv=Content-Type content="text/html; charset=windows-1252"><meta name=Generator content="Microsoft Word 12 (filtered)"><style><!--  /* Font Definitions */  @font-face  {font-family:"Cambria Math";  panose-1:2 4 5 3 5 4 6 3 2 4;} @font-face  {font-family:Cambria;  panose-1:2 4 5 3 5 4 6 3 2 4;} @font-face  {font-family:Calibri;  panose-1:2 15 5 2 2 2 4 3 2 4;} @font-face  {font-family:Tahoma;  panose-1:2 11 6 4 3 5 4 4 2 4;}  /* Style Definitions */  p.MsoNormal, li.MsoNormal, div.MsoNormal  {margin-top:0in;  margin-right:0in;  margin-bottom:10.0pt;  margin-left:0in;  line-height:115%;  font-size:11.0pt;  font-family:"Calibri","sans-serif";} h1  {mso-style-link:"Heading 1 Char";  margin-top:24.0pt;  margin-right:0in;  margin-bottom:0in;  margin-left:0in;  margin-bottom:.0001pt;  line-height:115%;  page-break-after:avoid;  font-size:14.0pt;  font-family:"Cambria","serif";  color:#365F91;} p.MsoTitle, li.MsoTitle, div.MsoTitle  {mso-style-link:"Title Char";  margin-top:0in;  margin-right:0in;  margin-bottom:15.0pt;  margin-left:0in;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst  {mso-style-link:"Title Char";  margin:0in;  margin-bottom:.0001pt;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle  {mso-style-link:"Title Char";  margin:0in;  margin-bottom:.0001pt;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast  {mso-style-link:"Title Char";  margin-top:0in;  margin-right:0in;  margin-bottom:15.0pt;  margin-left:0in;  border:none;  padding:0in;  font-size:26.0pt;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} a:link, span.MsoHyperlink  {color:blue;  text-decoration:underline;} a:visited, span.MsoHyperlinkFollowed  {color:purple;  text-decoration:underline;} p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap  {mso-style-link:"Document Map Char";  margin:0in;  margin-bottom:.0001pt;  font-size:8.0pt;  font-family:"Tahoma","sans-serif";} span.Heading1Char  {mso-style-name:"Heading 1 Char";  mso-style-link:"Heading 1";  font-family:"Cambria","serif";  color:#365F91;  font-weight:bold;} span.DocumentMapChar  {mso-style-name:"Document Map Char";  mso-style-link:"Document Map";  font-family:"Tahoma","sans-serif";} span.TitleChar  {mso-style-name:"Title Char";  mso-style-link:Title;  font-family:"Cambria","serif";  color:#17365D;  letter-spacing:.25pt;} .MsoPapDefault  {margin-bottom:10.0pt;  line-height:115%;} @page WordSection1  {size:8.5in 11.0in;  margin:1.0in 1.0in 1.0in 1.0in;} div.WordSection1  {page:WordSection1;} --></style> </head> <body lang=EN-US link=blue vlink=purple> <div class=WordSection1> <p class=MsoNormal><i>[Please read part 2 <a href="http://llorllale.blogspot.com/2013/04/the-case-of-sudden-oc4j-restarts-part-2.html">here</a>.]</i></p> <p class=MsoNormal>Our OC4J instance would restart itself every once in a while - no culprits found looking through unix' <i>history</i>. My next thought was to check the crontab but my user doesn't have access to that. Weighing bureaucracy (soliciting the unix admins to check it or give me access) versus pursuing other means of inquiry: <b>of course</b> I chose the latter!</p> <p class=MsoNormal>From the <a href="http://docs.oracle.com/cd/B13597_05/core.904/b12057/intro.htm#i1015084">opmn</a>log file:</p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>13/02/25 10:48:15 [ons-connect] Passive connection 16438,xxx.xxx.xxx.xxx,6233 missing connect</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>13/02/25 11:45:28 [ons-connect] Passive connection 1667c, xxx.xxx.xxx.xxx,6233 missing connect</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>13/02/25 12:06:18 [ons-connect] Passive connection 16751, xxx.xxx.xxx.xxx,6233 missing connect</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:22:19 [libopmnoc4j] OC4J ping attempt timed out</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:22:19 [libopmnoc4j] Process Ping Failed: default_group~oc4j_esbas~default_group~1 (1786977551:2786)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:23:09 [libopmnoc4j] OC4J ping attempt timed out</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:23:09 [libopmnoc4j] Process Ping Failed: default_group~oc4j_esbas~default_group~1 (1786977551:2786)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:23:59 [libopmnoc4j] OC4J ping attempt timed out</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:23:59 [libopmnoc4j] Process Ping Failed: default_group~oc4j_esbas~default_group~1 (1786977551:2786)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:23:59 [libopmnoc4j] Process Unreachable: default_group~oc4j_esbas~default_group~1 (1786977551:2786)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:23:59 [pm-process] Restarting Process: default_group~oc4j_esbas~default_group~1 (1786977551:2786)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:28:59 [pm-process] Stopping Process: default_group~oc4j_esbas~default_group~1 (1786977551:2786)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt;color:red'>13/02/25 14:28:59 [libopmnoc4j] Forcefully Terminating Process: default_group~oc4j_esbas~default_group~1 (1786977551:2786)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>13/02/25 14:29:01 [pm-process] Starting Process: default_group~oc4j_esbas~default_group~1 (1786977551:0)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>13/02/25 14:30:03 [pm-process] Process Alive: default_group~oc4j_esbas~default_group~1 (1786977551:9531)</span></p> <p class=MsoNormal>Classic Ping-Echo tactic to satisfy quality attributes related to availability in system architectures.</p> <p class=MsoNormal><i>Anything</i> could be causing those ping timeouts, but at least now I know I don't have to deal with the sysadmins. Neat.</p> <p class=MsoNormal>In the instance's message log I see a few instances of the following occurring at around the same timeframe:</p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>&lt;MESSAGE&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>  &lt;HEADER&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;TSTZ_ORIGINATING&gt;2013-02-25T14:21:57.735-04:00&lt;/TSTZ_ORIGINATING&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;COMPONENT_ID&gt;tip&lt;/COMPONENT_ID&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;MSG_TYPE TYPE=&quot;ERROR&quot;&gt;&lt;/MSG_TYPE&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;MSG_LEVEL&gt;1&lt;/MSG_LEVEL&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;HOST_ID&gt;hostid123&lt;/HOST_ID&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;HOST_NWADDR&gt;xxx.xxx.xxx.xxx&lt;/HOST_NWADDR&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;MODULE_ID&gt;esb.server.dispatch.agent&lt;/MODULE_ID&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;THREAD_ID&gt;90&lt;/THREAD_ID&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;USER_ID&gt;abcde&lt;/USER_ID&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>  &lt;/HEADER&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>  &lt;CORRELATION_DATA&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;EXEC_CONTEXT_ID&gt;&lt;UNIQUE_ID&gt;1697007412:56432:1360980064744:1021&lt;/UNIQUE_ID&gt;&lt;SEQ&gt;0&lt;/SEQ&gt;&lt;/EXEC_CONTEXT_ID&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>  &lt;/CORRELATION_DATA&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>  &lt;PAYLOAD&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;MSG_TEXT&gt;Failed to commit transaction&lt;/MSG_TEXT&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>    &lt;SUPPL_DETAIL&gt;&lt;![CDATA[oracle.tip.esb.server.common.exceptions.BusinessEventRetriableException: Failed to commit transaction; transaction status is &quot;6&quot;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at oracle.tip.esb.server.common.JTAHelper.commitTransaction(JTAHelper.java:216)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at oracle.tip.esb.server.dispatch.agent.ESBWork.run(ESBWork.java:155)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at oracle.j2ee.connector.work.WorkWrapper.runTargetWork(WorkWrapper.java:242)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at oracle.j2ee.connector.work.WorkWrapper.doWork(WorkWrapper.java:215)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at oracle.j2ee.connector.work.WorkWrapper.run(WorkWrapper.java:190)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(PooledExecutor.java:825)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at java.lang.Thread.run(Thread.java:595)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>Caused by: javax.transaction.RollbackException: Timed out</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at com.evermind.server.ApplicationServerTransaction.checkForRollbackOnlyWhileInCommit(ApplicationServerTransaction.java:664)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at com.evermind.server.ApplicationServerTransaction.doCommit(ApplicationServerTransaction.java:273)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at com.evermind.server.ApplicationServerTransaction.commit(ApplicationServerTransaction.java:162)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at com.evermind.server.ApplicationServerTransactionManager.commit(ApplicationServerTransactionManager.java:475)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        at oracle.tip.esb.server.common.JTAHelper.commitTransaction(JTAHelper.java:214)</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>        ... 6 more</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>]]&gt;&lt;/SUPPL_DETAIL&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>  &lt;/PAYLOAD&gt;</span></p> <p class=MsoNormal style='margin-left:.5in;line-height:normal'><span style='font-size:9.0pt'>&lt;/MESSAGE&gt;</span></p> <p class=MsoNormal>This message eventually turned out to be a dead end. My immediate hypothesis is that the server is under load and thus transactions are starting to hang and being rolled back, as well as being unable to respond to OPMN's ping requests. Threads can get stuck due to many different causes, such as waiting for some I/O to complete, or entering a loop without exit condition, or competing for shared resources with other threads, etc. To find out what exactly was happening, I first need to identify the components involved in this transaction. And this is where I stumbled on my first roadblock. <i>How</i> do I trace this message back to a component. It is obvious that the <i>CORRELATION_DATA</i>element is somehow pointing me in some direction, but how do I interpret its <i>UNIQUE_ID</i>? I have yet to find a clear description of this element's contents. From <a href="http://docs.oracle.com/cd/B14099_19/core.1012/b13995/log.htm#i1039644">Oracle</a>:</p> <p class=MsoNormal style='margin-left:.5in'><span style='font-size:9.0pt; line-height:115%'>Using ODL, diagnostic messages are written to log files using XML format and each message includes a HEADER element containing information about the message, <b>optionally a CORRELATION_DATA element containing information to assist in correlating messages across components</b>, and a PAYLOAD element containing the message text including optional arguments and associated values.</span></p> <p class=MsoNormal>... and that's it. My hypothesis is that the <i>UNIQUE_ID</i>element's text value is a string of values delimited by colons, and each value serves as a unique identifier for every instance of any components involved in the handling of this message or operation. So far I have not been able to prove this. I haven't conclusively linked any of those values to any BPEL or ESB instance ID. If anyone out there can point to a clear description of the <i>CORRELATION_DATA</i>element and what those values above would  mean, it would be very welcome!</p> <p class=MsoNormal>Next thought: monitor GC performance. It is possible that the garbage collecting mechanism is occasionally interfering with the OC4J instance's ability to respond to OPMN's ping requests. If, say, a full garbage collection is taking place (which can potentially last up to tens of seconds) while OPMN's ping arrives, then yes, a timeout can definitely happen. </p> <p class=MsoNormal>Which is why I have added these flags to the process' <i>java-options</i>in opmn.xml:</p> <p class=MsoNormal>                <span style='font-size:9.0pt;line-height: 115%'>-XX:-PrintGCDetails -XX:-PrintGCTimeStamps -Xloggc:gc.log</span></p> <p class=MsoNormal>Now it's just a matter of waiting for the next event...</p> </div> </body> </html>